<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Tiger PWL</title>

<style>
    :root {
        --orange: #a34700;
        --bg-dark: #050505;
        --panel-dark: #141414;
        --border-dark: #333;
    }

    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: var(--bg-dark);
        color: #fff;
    }

    .screen {
        display: none;
        padding: 16px;
        min-height: 100vh;
        background-color: var(--orange);
    }

    .screen.active {
        display: block;
    }

    h1, h2 {
        text-align: center;
        margin-top: 0;
    }

    h1 {
        font-size: 30px;
    }

    h2 {
        font-size: 24px;
    }

    .home-btn, .btn {
        display: block;
        width: 100%;
        border: none;
        padding: 16px;
        margin: 10px 0;
        font-size: 18px;
        color: #fff;
        background-color: var(--panel-dark);
        border-radius: 10px;
    }

    .home-btn {
        font-size: 20px;
        background-color: #1c1c1c;
    }

    .home-btn:active, .btn:active {
        opacity: 0.8;
    }

    .panel {
        background-color: var(--panel-dark);
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 14px;
    }

    .lifter-row {
        border-bottom: 2px solid var(--orange);
        padding: 8px 0;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
    }

    .lifter-header {
        width: 100%;
        font-weight: bold;
        margin-bottom: 6px;
        font-size: 16px;
    }

    .line {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 4px;
        width: 100%;
    }

    .label {
        font-size: 12px;
        margin-right: 2px;
    }

    input[type="text"], input[type="number"] {
        height: 45px; /* medium size */
        font-size: 16px;
        border-radius: 6px;
        border: 2px solid var(--border-dark);
        background-color: #1e1e1e;
        color: #fff;
        text-align: center;
        padding: 0 4px;
    }

    .small-input {
        width: 110px;
    }

    .attempt-input {
        width: 70px;
    }

    .total-box {
        font-weight: bold;
        font-size: 18px;
        margin-left: auto;
        padding-left: 8px;
        min-width: 60px;
        text-align: right;
    }

    .row-totals {
        display: flex;
        align-items: center;
        width: 100%;
        margin-top: 6px;
    }

    .meet-list-btn {
        text-align: left;
        font-size: 16px;
    }

    .subtitle {
        text-align: center;
        margin-bottom: 8px;
        font-size: 14px;
        opacity: 0.9;
    }
</style>
</head>
<body>

<!-- HOME SCREEN -->
<div id="home" class="screen active">
    <h1>Tiger PWL</h1>
    <p class="subtitle">Meet tracker for 12 lifters</p>

    <button class="home-btn" onclick="showScreen('newMeet')">Start New Meet</button>
    <button class="home-btn" onclick="loadMeetList()">Load Old Meet</button>
    <button class="home-btn" onclick="showScreen('competitors')">Competitors Sheet</button>
</div>

<!-- NEW MEET SETUP -->
<div id="newMeet" class="screen">
    <h2>Enter Your Lifters</h2>
    <p class="subtitle">Up to 12 lifters – Name, Lifter #, Rack #</p>
    <div class="panel" id="lifterInputs"></div>

    <button class="btn" onclick="createMeet()">Create Meet Sheet</button>
    <button class="btn" onclick="showScreen('home')">Back to Home</button>
</div>

<!-- MAIN MEET SHEET -->
<div id="meetSheet" class="screen">
    <h2>Meet Sheet (Your Team)</h2>
    <div class="panel" id="meetRows"></div>

    <button class="btn" onclick="saveMeet()">Save Meet</button>
    <button class="btn" onclick="resetMeet()">Reset Meet Sheet</button>
    <button class="btn" onclick="showScreen('home')">Home</button>
</div>

<!-- LOAD MEET SCREEN -->
<div id="loadMeet" class="screen">
    <h2>Load Saved Meet</h2>
    <div class="panel" id="loadList"></div>
    <button class="btn" onclick="showScreen('home')">Home</button>
</div>

<!-- COMPETITORS SHEET -->
<div id="competitors" class="screen">
    <h2>Competitors Sheet</h2>
    <p class="subtitle">Track other lifters (same layout)</p>
    <div class="panel" id="competitorRows"></div>

    <button class="btn" onclick="saveCompetitors()">Save Competitors</button>
    <button class="btn" onclick="loadCompetitors()">Load Competitors</button>
    <button class="btn" onclick="showScreen('home')">Home</button>
</div>

<script>
// ----- GLOBALS -----
const MEET_PREFIX = 'TigerPWL_meet_';
const COMP_KEY = 'TigerPWL_competitors';

let meetData = [];        // current meet lifters + attempts
let competitorData = [];  // competitors lifters + attempts

// ----- SCREEN SWITCH -----
function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

// ----- NEW MEET SETUP -----
function buildNewMeetInputs() {
    const container = document.getElementById('lifterInputs');
    container.innerHTML = '';
    for (let i = 1; i <= 12; i++) {
        const row = document.createElement('div');
        row.className = 'lifter-row';
        row.innerHTML = `
            <div class="line">
                <span class="label">${i}.</span>
                <input class="small-input" type="text" placeholder="Name" id="nm_${i}">
                <input class="small-input" type="text" placeholder="Lifter #" id="num_${i}">
                <input class="small-input" type="text" placeholder="Rack #" id="rk_${i}">
            </div>
        `;
        container.appendChild(row);
    }
}

// build lifter inputs when page first loads
buildNewMeetInputs();

// ----- CREATE MEET SHEET -----
function createMeet() {
    meetData = [];
    for (let i = 1; i <= 12; i++) {
        const name = document.getElementById(`nm_${i}`).value.trim();
        const num = document.getElementById(`num_${i}`).value.trim();
        const rack = document.getElementById(`rk_${i}`).value.trim();
        if (!name && !num && !rack) {
            // allow blanks but still create row
        }
        meetData.push({
            name,
            num,
            rack,
            sq: ["", "", ""],
            be: ["", "", ""],
            dl: ["", "", ""]
        });
    }
    renderMeetSheet();
    showScreen('meetSheet');
}

// ----- RENDER MEET SHEET -----
function renderMeetSheet() {
    const container = document.getElementById('meetRows');
    container.innerHTML = '';

    meetData.forEach((lifter, idx) => {
        const row = document.createElement('div');
        row.className = 'lifter-row';
        row.dataset.context = 'meet';
        row.dataset.index = idx;

        row.innerHTML = `
            <div class="lifter-header">
                ${lifter.name || 'Lifter ' + (idx + 1)}
                ${lifter.num ? ` (#${lifter.num})` : ''} 
                ${lifter.rack ? ` – Rack ${lifter.rack}` : ''}
            </div>

            <div class="line">
                <span class="label">SQ1</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.sq[0]}" 
                    oninput="onAttemptChange('meet', ${idx}, 'sq', 0, this.value)">
                <span class="label">SQ2</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.sq[1]}" 
                    oninput="onAttemptChange('meet', ${idx}, 'sq', 1, this.value)">
                <span class="label">SQ3</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.sq[2]}" 
                    oninput="onAttemptChange('meet', ${idx}, 'sq', 2, this.value)">

                <span class="label">BE1</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.be[0]}" 
                    oninput="onAttemptChange('meet', ${idx}, 'be', 0, this.value)">
                <span class="label">BE2</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.be[1]}" 
                    oninput="onAttemptChange('meet', ${idx}, 'be', 1, this.value)">
                <span class="label">BE3</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.be[2]}" 
                    oninput="onAttemptChange('meet', ${idx}, 'be', 2, this.value)">
            </div>

            <div class="line">
                <span class="label">DL1</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.dl[0]}" 
                    oninput="onAttemptChange('meet', ${idx}, 'dl', 0, this.value)">
                <span class="label">DL2</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.dl[1]}" 
                    oninput="onAttemptChange('meet', ${idx}, 'dl', 1, this.value)">
                <span class="label">DL3</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.dl[2]}" 
                    oninput="onAttemptChange('meet', ${idx}, 'dl', 2, this.value)">
            </div>

            <div class="row-totals">
                <span class="label">SQ+BE</span>
                <div class="total-box" id="meet_sub_${idx}">0</div>
                <span class="label" style="margin-left:8px;">TOTAL</span>
                <div class="total-box" id="meet_final_${idx}">0</div>
            </div>
        `;
        container.appendChild(row);
        updateTotals('meet', idx); // ensure totals render
    });
}

// ----- ATTEMPT CHANGE HANDLER -----
function onAttemptChange(context, idx, liftType, attemptIndex, value) {
    const arr = (context === 'meet' ? meetData : competitorData)[idx][liftType];
    arr[attemptIndex] = value;
    updateTotals(context, idx);
    if (context === 'competitors') {
        // also update name/num/rack in competitorData in case changed
        syncCompetitorMetaFromDOM(idx);
    }
}

// ----- UPDATE TOTALS -----
function updateTotals(context, idx) {
    const dataArr = context === 'meet' ? meetData : competitorData;
    const lifter = dataArr[idx];

    const sqNums = lifter.sq.map(v => Number(v) || 0);
    const beNums = lifter.be.map(v => Number(v) || 0);
    const dlNums = lifter.dl.map(v => Number(v) || 0);

    const sqBest = Math.max(...sqNums);
    const beBest = Math.max(...beNums);
    const dlBest = Math.max(...dlNums);

    const sub = sqBest + beBest;
    const total = sub + dlBest;

    const subEl = document.getElementById(`${context}_sub_${idx}`);
    const finalEl = document.getElementById(`${context}_final_${idx}`);
    if (subEl) subEl.textContent = sub;
    if (finalEl) finalEl.textContent = total;
}

// ----- SAVE MEET -----
function saveMeet() {
    if (!meetData || meetData.length === 0) {
        alert('No meet data to save.');
        return;
    }
    const name = prompt('Meet name?', 'Tiger Meet');
    const payload = {
        name: name || 'Unnamed Meet',
        timestamp: Date.now(),
        data: meetData
    };
    const key = MEET_PREFIX + payload.timestamp;
    localStorage.setItem(key, JSON.stringify(payload));
    alert('Meet saved!');
}

// ----- LOAD MEET LIST -----
function loadMeetList() {
    const container = document.getElementById('loadList');
    container.innerHTML = '';

    const items = [];
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith(MEET_PREFIX)) {
            const obj = JSON.parse(localStorage.getItem(key) || '{}');
            items.push({ key, ...obj });
        }
    }

    if (items.length === 0) {
        container.innerHTML = '<p>No saved meets yet.</p>';
    } else {
        // latest first
        items.sort((a, b) => b.timestamp - a.timestamp);
        items.forEach(item => {
            const d = new Date(item.timestamp);
            const label = `${item.name} – ${d.toLocaleString()}`;
            const btn = document.createElement('button');
            btn.className = 'home-btn meet-list-btn';
            btn.textContent = label;
            btn.onclick = () => loadMeet(item.key);
            container.appendChild(btn);
        });
    }

    showScreen('loadMeet');
}

function loadMeet(key) {
    const obj = JSON.parse(localStorage.getItem(key) || '{}');
    if (!obj || !obj.data) {
        alert('Cannot load this meet.');
        return;
    }
    meetData = obj.data;
    renderMeetSheet();
    showScreen('meetSheet');
}

// ----- RESET MEET SHEET -----
function resetMeet() {
    if (!confirm('Clear all attempts (names stay the same)?')) return;
    meetData.forEach(l => {
        l.sq = ["", "", ""];
        l.be = ["", "", ""];
        l.dl = ["", "", ""];
    });
    renderMeetSheet();
}

// ----- COMPETITORS SHEET -----
function initCompetitors() {
    competitorData = [];
    for (let i = 0; i < 12; i++) {
        competitorData.push({
            name: '',
            num: '',
            rack: '',
            sq: ["", "", ""],
            be: ["", "", ""],
            dl: ["", "", ""]
        });
    }
    renderCompetitors();
}

function renderCompetitors() {
    const container = document.getElementById('competitorRows');
    container.innerHTML = '';

    competitorData.forEach((lifter, idx) => {
        const row = document.createElement('div');
        row.className = 'lifter-row';
        row.dataset.context = 'competitors';
        row.dataset.index = idx;

        row.innerHTML = `
            <div class="line">
                <span class="label">${idx + 1}.</span>
                <input class="small-input" type="text" placeholder="Name"
                    value="${lifter.name}"
                    oninput="onCompetitorMetaChange(${idx}, 'name', this.value)">
                <input class="small-input" type="text" placeholder="Lifter #"
                    value="${lifter.num}"
                    oninput="onCompetitorMetaChange(${idx}, 'num', this.value)">
                <input class="small-input" type="text" placeholder="Rack #"
                    value="${lifter.rack}"
                    oninput="onCompetitorMetaChange(${idx}, 'rack', this.value)">
            </div>

            <div class="line">
                <span class="label">SQ1</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.sq[0]}"
                    oninput="onAttemptChange('competitors', ${idx}, 'sq', 0, this.value)">
                <span class="label">SQ2</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.sq[1]}"
                    oninput="onAttemptChange('competitors', ${idx}, 'sq', 1, this.value)">
                <span class="label">SQ3</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.sq[2]}"
                    oninput="onAttemptChange('competitors', ${idx}, 'sq', 2, this.value)">

                <span class="label">BE1</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.be[0]}"
                    oninput="onAttemptChange('competitors', ${idx}, 'be', 0, this.value)">
                <span class="label">BE2</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.be[1]}"
                    oninput="onAttemptChange('competitors', ${idx}, 'be', 1, this.value)">
                <span class="label">BE3</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.be[2]}"
                    oninput="onAttemptChange('competitors', ${idx}, 'be', 2, this.value)">
            </div>

            <div class="line">
                <span class="label">DL1</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.dl[0]}"
                    oninput="onAttemptChange('competitors', ${idx}, 'dl', 0, this.value)">
                <span class="label">DL2</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.dl[1]}"
                    oninput="onAttemptChange('competitors', ${idx}, 'dl', 1, this.value)">
                <span class="label">DL3</span>
                <input class="attempt-input" type="number" inputmode="decimal"
                    value="${lifter.dl[2]}"
                    oninput="onAttemptChange('competitors', ${idx}, 'dl', 2, this.value)">
            </div>

            <div class="row-totals">
                <span class="label">SQ+BE</span>
                <div class="total-box" id="competitors_sub_${idx}">0</div>
                <span class="label" style="margin-left:8px;">TOTAL</span>
                <div class="total-box" id="competitors_final_${idx}">0</div>
            </div>
        `;
        container.appendChild(row);
        updateTotals('competitors', idx);
    });
}

function onCompetitorMetaChange(idx, field, value) {
    competitorData[idx][field] = value;
}

function syncCompetitorMetaFromDOM(idx) {
    // not strictly necessary now; kept for safety if needed later
}

// save competitors
function saveCompetitors() {
    const payload = {
        timestamp: Date.now(),
        data: competitorData
    };
    localStorage.setItem(COMP_KEY, JSON.stringify(payload));
    alert('Competitors saved!');
}

function loadCompetitors() {
    const raw = localStorage.getItem(COMP_KEY);
    if (!raw) {
        alert('No saved competitors.');
        return;
    }
    const obj = JSON.parse(raw);
    if (!obj.data) {
        alert('No saved competitors data.');
        return;
    }
    competitorData = obj.data;
    renderCompetitors();
    alert('Competitors loaded!');
}

// init competitors on first load
initCompetitors();
</script>

</body>
</html>
